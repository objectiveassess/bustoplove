<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>ì‹œê°„ ë˜ê°ê¸° ì‹œê³„ v2</title>
<link rel="icon" href="data:,">
<style>
  :root{
    --bg: #fce4ec;       /* ì—°í•œ ë¶„í™ */
    --clock-bg: #ffffff; /* ì‹œê³„ ë°°ê²½ í°ìƒ‰ */
    --tick: #000000;     /* ê²€ì • ëˆˆê¸ˆ */
    --fill: #fff9c4;     /* ì—°í•œ ë…¸ë‘ (ì±„ì›Œì§€ëŠ” ìƒ‰) */
    --center-line: #1e3a5f; /* ì¤‘ì•™ íŒŒë€ì„  */
  }

  html,body{
    height:100%;
    margin:0;
    font-family: 'Noto Sans KR', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    background: var(--bg);
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .wrap{
    width:100%;
    max-width:920px;
    padding:20px;
    box-sizing:border-box;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:22px;
  }

  .clocks{
    width:100%;
    display:flex;
    gap:40px;
    align-items:center;
    justify-content:center;
    flex-wrap:wrap;
  }

  .clock-box{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:10px;
  }

  canvas.clock {
    width: 300px;
    height: 300px;
    max-width: 42vmin;
    max-height: 42vmin;
    background: var(--clock-bg);
    border-radius:50%;
    box-shadow: 0 6px 16px rgba(0,0,0,0.08);
    touch-action: none; /* pointer events handling */
    -webkit-user-select:none;
    user-select:none;
  }

  .label {
    color:#333;
    font-size:14px;
  }

  /* ìº¡ì²˜ ë²„íŠ¼ (ì•„ì´ì½˜í˜•, í•˜ë‹¨ ì¤‘ì•™) */
  .controls{
    width:100%;
    display:flex;
    justify-content:center;
    margin-top:6px;
  }

  button.capture {
    width:66px;
    height:66px;
    border-radius:50%;
    border:none;
    background:var(--fill);
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow: 0 6px 14px rgba(0,0,0,0.12);
    cursor:pointer;
    transition: transform .12s ease, box-shadow .12s ease;
  }
  button.capture:active{ transform: scale(.98); box-shadow:0 4px 10px rgba(0,0,0,0.14); }
  button.capture svg{ width:28px; height:28px; }

  /* í† ìŠ¤íŠ¸ / íŒì—… */
  .toast{
    position: fixed;
    left:50%;
    transform: translateX(-50%);
    bottom:26px;
    background: rgba(0,0,0,0.82);
    color: #fff;
    padding:12px 16px;
    border-radius:12px;
    font-size:14px;
    display:none;
    z-index:9999;
  }

  /* small hint on top */
  .hint{
    color:#444;
    font-size:13px;
  }

  @media (max-width:560px){
    .clocks{ gap:18px; }
    .hint{ font-size:12px; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="hint">ì™¼ìª½ ì‹œê³„ë¥¼ ì†ê°€ë½(ë˜ëŠ” ë§ˆìš°ìŠ¤)ìœ¼ë¡œ ì›ì„ ë”°ë¼ ëŒë ¤ì„œ ê°ì •ì„ í‘œí˜„í•˜ì„¸ìš”. ì˜¤ë¥¸ìª½ì€ ìƒëŒ€(ì ê¹€).</div>

    <div class="clocks" id="capture-area">
      <div class="clock-box">
        <canvas id="leftClock" class="clock" width="600" height="600" aria-label="ë‚´ ê°ì • ì‹œê³„"></canvas>
        <div class="label">ë‚´ ì‹œê³„ (ì¡°ì‘ ê°€ëŠ¥)</div>
      </div>

      <div class="clock-box">
        <canvas id="rightClock" class="clock" width="600" height="600" aria-label="ìƒëŒ€ ì‹œê³„"></canvas>
        <div class="label">ìƒëŒ€ ì‹œê³„ (ì ê¹€)</div>
      </div>
    </div>

    <div class="controls">
      <button class="capture" id="captureBtn" title="ìº¡ì²˜ í›„ ì €ì¥ (ìŠ¤í† ë¦¬ì— ì—…ë¡œë“œ)">
        <!-- camera SVG icon -->
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M4 7h3l2-2h6l2 2h3v11a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V7z" stroke="#333" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="12" cy="13" r="3" stroke="#333" stroke-width="1.2"/>
        </svg>
      </button>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <!-- html2canvas for capture -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
/* ---------- ìœ í‹¸ ---------- */
function showToast(text, ms=2800){
  const t = document.getElementById('toast');
  t.textContent = text;
  t.style.display = 'block';
  t.style.opacity = '1';
  clearTimeout(t._hid);
  t._hid = setTimeout(()=>{ t.style.display='none'; }, ms);
}

/* ---------- ìº”ë²„ìŠ¤ ì‹œê³„ ê·¸ë¦¬ê¸° ---------- */
function makeClock(canvas, options={}) {
  const ctx = canvas.getContext('2d');
  const DPR = Math.max(1, window.devicePixelRatio || 1);
  const W = canvas.width;
  const H = canvas.height;
  ctx.setTransform(DPR,0,0,DPR,0,0);

  const center = { x: W/2, y: H/2 };
  const radius = Math.min(W,H) * 0.46; // ì•½ê°„ ì—¬ìœ 
  const ringsGap = 12;

  function clear(){
    ctx.clearRect(0,0,W,H);
  }

  function drawBase(){
    // ë°°ê²½ ì›
    ctx.beginPath();
    ctx.arc(center.x, center.y, radius, 0, Math.PI*2);
    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--clock-bg') || '#fff';
    ctx.fill();

    // ì—¬ëŸ¬ ê²¹ì˜ ì–‡ì€ ì› (íŒ½ì´ë¬´ëŠ¬)
    ctx.strokeStyle = 'rgba(0,0,0,0.9)';
    ctx.lineWidth = 1;
    for(let r = 20; r <= radius - 6; r += ringsGap){
      ctx.beginPath();
      ctx.arc(center.x, center.y, r, 0, Math.PI*2);
      ctx.stroke();
    }

    // ì‹œê³„ ëˆˆê¸ˆ 12ê°œ
    ctx.lineWidth = 2;
    for(let i=0;i<12;i++){
      const ang = (i * 30 - 90) * Math.PI/180;
      const x1 = center.x + Math.cos(ang) * (radius - 10);
      const y1 = center.y + Math.sin(ang) * (radius - 10);
      const x2 = center.x + Math.cos(ang) * (radius);
      const y2 = center.y + Math.sin(ang) * (radius);
      ctx.beginPath();
      ctx.moveTo(x1,y1);
      ctx.lineTo(x2,y2);
      ctx.stroke();
    }

    // ì¤‘ì•™ íŒŒë€ì„  (12ì‹œ ë°©í–¥)
    ctx.beginPath();
    ctx.moveTo(center.x, center.y);
    ctx.lineTo(center.x, center.y - radius);
    ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--center-line') || '#1e3a5f';
    ctx.lineWidth = 3;
    ctx.stroke();
  }

  function drawFill(angleDeg){
    if(!angleDeg || angleDeg <= 0) return;
    // arc from -90deg to -90 + angleDeg
    const start = -Math.PI/2;
    const end = start + angleDeg * Math.PI/180;
    ctx.beginPath();
    ctx.moveTo(center.x, center.y);
    ctx.arc(center.x, center.y, radius, start, end, false);
    ctx.closePath();
    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--fill') || '#fff9c4';
    ctx.fill();
  }

  function render(angleDeg){
    clear();
    drawBase();
    drawFill(angleDeg);
    // redraw center dot if desired (not necessary)
    ctx.beginPath();
    ctx.arc(center.x, center.y, 6, 0, Math.PI*2);
    ctx.fillStyle = '#111';
    ctx.fill();
  }

  // expose functions
  return {
    render,
    center,
    radius
  };
}

/* ---------- ìƒí˜¸ì‘ìš©: ì›í˜• íšŒì „ (PC/í„°ì¹˜ í†µí•© pointer ì´ë²¤íŠ¸) ---------- */
(function init(){
  const leftCanvas = document.getElementById('leftClock');
  const rightCanvas = document.getElementById('rightClock');

  const leftClock = makeClock(leftCanvas);
  const rightClock = makeClock(rightCanvas);

  // ì´ˆê¸° ë Œë” (ë‘˜ ë‹¤ ë¹„ì–´ìˆëŠ” ê¸°ë³¸ ìƒíƒœ)
  leftClock.render(0);
  rightClock.render(0); // ì˜¤ë¥¸ìª½ì€ ì ê¹€ ìƒíƒœ(ë¹„ì–´ ìˆìŒ)

  // ìƒíƒœ
  let dragging = false;
  let activeCanvas = null;
  let lastAngle = 0;

  function getAngleFromEvent(e, canvas, clock){
    const rect = canvas.getBoundingClientRect();
    const clientX = (e.clientX !== undefined) ? e.clientX : (e.touches && e.touches[0] && e.touches[0].clientX);
    const clientY = (e.clientY !== undefined) ? e.clientY : (e.touches && e.touches[0] && e.touches[0].clientY);
    if(clientX === undefined || clientY === undefined) return null;
    const cx = rect.left + rect.width/2;
    const cy = rect.top + rect.height/2;
    const dx = clientX - cx;
    const dy = clientY - cy;
    // atan2(y, x) but we want 0 at top (12ì‹œ) and increasing clockwise
    let theta = Math.atan2(dy, dx) * 180 / Math.PI; // -180 ~ 180, 0 at +x
    theta = theta + 90; // shift so 0 at -y (12ì‹œ)
    if(theta < 0) theta += 360;
    return theta; // degrees [0,360)
  }

  /* ---------- left canvas pointer handlers ---------- */
  function onPointerDownLeft(e){
    e.preventDefault();
    dragging = true;
    activeCanvas = leftCanvas;
    leftCanvas.setPointerCapture && leftCanvas.setPointerCapture(e.pointerId);
    const angle = getAngleFromEvent(e, leftCanvas);
    if(angle !== null){
      lastAngle = angle;
      leftClock.render(angle);
    }
  }

  function onPointerMoveLeft(e){
    if(!dragging || activeCanvas !== leftCanvas) return;
    e.preventDefault();
    const angle = getAngleFromEvent(e, leftCanvas);
    if(angle !== null){
      lastAngle = angle;
      leftClock.render(angle);
    }
  }

  function onPointerUpLeft(e){
    if(activeCanvas === leftCanvas){
      // release
      dragging = false;
      activeCanvas = null;
      // ê°„ë‹¨í•œ ì•ˆë‚´
      showToast('ì„¤ì • ì™„ë£Œ! ìº¡ì²˜ ë²„íŠ¼ìœ¼ë¡œ ì €ì¥í•˜ì„¸ìš”. ğŸ“¸', 1800);
    }
  }

  /* ---------- right canvas handlers (ì ê¹€) ---------- */
  function onPointerDownRight(e){
    e.preventDefault();
    // ë°”ë¡œ ì•ˆë‚´ íŒì—… ë„ìš°ê¸°
    showToast('ìƒëŒ€ë°©ì˜ ê°ì •ì€ ë³¸ì¸ì´ ê±´ë“œë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 2400);
  }

  /* ---------- attach pointer events (pointer API try) ---------- */
  // left
  leftCanvas.addEventListener('pointerdown', onPointerDownLeft, {passive:false});
  window.addEventListener('pointermove', onPointerMoveLeft, {passive:false});
  window.addEventListener('pointerup', onPointerUpLeft, {passive:false});

  // right (blocked)
  rightCanvas.addEventListener('pointerdown', onPointerDownRight, {passive:false});
  // prevent accidental dragging on right for touchmove
  rightCanvas.addEventListener('touchstart', function(e){ e.preventDefault(); showToast('ìƒëŒ€ë°©ì˜ ê°ì •ì€ ë³¸ì¸ì´ ê±´ë“œë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 2400); }, {passive:false});

  /* ---------- capture ë²„íŠ¼ ë™ì‘ (html2canvas ì‚¬ìš©) ---------- */
  const captureBtn = document.getElementById('captureBtn');
  captureBtn.addEventListener('click', async ()=>{
    captureBtn.disabled = true;
    captureBtn.style.opacity = '0.8';
    try{
      const area = document.getElementById('capture-area');
      const canvas = await html2canvas(area, {
        backgroundColor: null,
        scale: Math.min(2, window.devicePixelRatio || 1.5)
      });
      // ë‹¤ìš´ë¡œë“œ
      const link = document.createElement('a');
      link.download = `time_of_us_${Date.now()}.png`;
      link.href = canvas.toDataURL('image/png');
      link.click();
      showToast('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ìŠ¤í† ë¦¬ì— ì—…ë¡œë“œí•˜ì„¸ìš”. ğŸ™Œ', 2200);
    } catch(err){
      console.error(err);
      showToast('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.', 3200);
    } finally{
      captureBtn.disabled = false;
      captureBtn.style.opacity = '1';
    }
  });

  /* ---------- í„°ì¹˜ì—ì„œ pointer ì´ë²¤íŠ¸ ë¯¸ì§€ì› ë¸Œë¼ìš°ì € ëŒ€ë¹„ (fallback) ---------- */
  // pointer eventsê°€ ì—†ì„ ê²½ìš° touch ì´ë²¤íŠ¸ë¡œ ë³´ì™„ (ëŒ€ë¶€ë¶„ ëª¨ë°”ì¼ì€ pointer ì§€ì›í•˜ì§€ë§Œ ì•ˆì „ì¥ì¹˜)
  if(!window.PointerEvent){
    leftCanvas.addEventListener('touchstart', function(e){ onPointerDownLeft(e.touches[0]); }, {passive:false});
    leftCanvas.addEventListener('touchmove', function(e){ onPointerMoveLeft(e.touches[0]); }, {passive:false});
    leftCanvas.addEventListener('touchend', function(e){ onPointerUpLeft(e.changedTouches[0]); }, {passive:false});
    rightCanvas.addEventListener('touchstart', function(e){ onPointerDownRight(e.touches[0]); }, {passive:false});
  }

  /* ---------- resize ì²˜ë¦¬: ìº”ë²„ìŠ¤ CSSì™€ ë‚´ë¶€ í•´ìƒë„ëŠ” ê³ ì •ìœ¼ë¡œ ë’€ìŒ (responsive via CSS max-width) ---------- */
  // Render continuously to reflect devicePixelRatio properly would be more complex.
})();
  </script>
</body>
</html>
