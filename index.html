<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>í™˜ìŠ¹â€¦í• ê±°ì•¼?</title>
<link rel="icon" href="data:,">
<style>
  :root{
    --bg:#fce4ec;
    --clock-bg:#ffffff;
    --tick:#000000;
    --fill:#fff9c4;
    --center-line:#1e3a5f;
  }
  html,body{height:100%;margin:0;font-family:'Noto Sans KR',system-ui, -apple-system, "Segoe UI", Roboto, Arial;}
  body{background:var(--bg);display:flex;align-items:flex-start;justify-content:center;padding:28px 18px;box-sizing:border-box;}
  .wrap{width:100%;max-width:980px;margin:0 auto;display:flex;flex-direction:column;align-items:center;gap:18px;}

  /* ì œëª© */
  h1.title{
    margin:0;
    font-size:22px;
    color:#222;
    letter-spacing:0.6px;
    font-weight:600;
  }
  p.subtitle{ margin:0; color:#555; font-size:13px; margin-top:6px; }

  .clocks{
    width:100%;
    margin-top:16px;
    display:flex;
    gap:48px;
    align-items:center;
    justify-content:center;
    flex-wrap:wrap;
  }

  .clock-box{ display:flex;flex-direction:column;align-items:center;gap:10px; }

  /* ìº”ë²„ìŠ¤ëŠ” CSS ì‚¬ì´ì¦ˆë¡œ ë°˜ì‘í•˜ì§€ë§Œ ë‚´ë¶€ í•´ìƒë„ëŠ” JSì—ì„œ DPRë¡œ ì„¤ì • */
  canvas.clock{
    width: 320px;
    height: 320px;
    max-width: 46vmin;
    max-height: 46vmin;
    background: var(--clock-bg);
    border-radius:50%;
    box-shadow:0 8px 20px rgba(0,0,0,0.08);
    touch-action:none;
    -webkit-user-select:none;
    user-select:none;
  }

  .label{ font-size:13px;color:#333; }

  .controls{ width:100%; display:flex; justify-content:center; margin-top:8px; }
  button.capture{
    width:66px;height:66px;border-radius:50%;border:none;background:var(--fill);display:flex;align-items:center;justify-content:center;
    box-shadow:0 6px 14px rgba(0,0,0,0.12); cursor:pointer; transition: transform .12s ease;
  }
  button.capture:active{ transform:scale(.98); }

  .toast{ position:fixed; left:50%; transform:translateX(-50%); bottom:28px; background:rgba(0,0,0,0.82); color:#fff; padding:12px 16px;
    border-radius:12px; font-size:14px; display:none; z-index:9999; }

  @media (max-width:600px){
    h1.title{ font-size:18px; }
    canvas.clock{ width: 44vmin; height:44vmin; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <h1 class="title">í™˜ìŠ¹â€¦í• ê±°ì•¼?</h1>
    <p class="subtitle">ì™¼ìª½ ì‹œê³„ë¥¼ ì†ê°€ë½(ë˜ëŠ” ë§ˆìš°ìŠ¤)ìœ¼ë¡œ ì›ì„ ë”°ë¼ ëŒë ¤ ê°ì •ì„ í‘œí˜„í•˜ì„¸ìš”. ì˜¤ë¥¸ìª½ì€ ìƒëŒ€(ì ê¹€).</p>

    <div class="clocks" id="capture-area">
      <div class="clock-box">
        <canvas id="leftClock" class="clock" aria-label="ë‚´ ì‹œê³„"></canvas>
        <div class="label">ë‚´ ì‹œê³„ (ì¡°ì‘ ê°€ëŠ¥)</div>
      </div>

      <div class="clock-box">
        <canvas id="rightClock" class="clock" aria-label="ìƒëŒ€ ì‹œê³„"></canvas>
        <div class="label">ìƒëŒ€ ì‹œê³„ (ì ê¹€)</div>
      </div>
    </div>

    <div class="controls">
      <button class="capture" id="captureBtn" title="ìº¡ì²˜ í›„ ìë™ì €ì¥">
        <!-- camera icon -->
        <svg viewBox="0 0 24 24" width="28" height="28" fill="none" aria-hidden="true">
          <path d="M4 7h3l2-2h6l2 2h3v11a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V7z" stroke="#333" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="12" cy="13" r="3" stroke="#333" stroke-width="1.2"/>
        </svg>
      </button>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <!-- html2canvas (ìº¡ì²˜) -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
/* -------------- í† ìŠ¤íŠ¸ -------------- */
function showToast(txt, ms=2400){
  const t = document.getElementById('toast');
  t.textContent = txt;
  t.style.display = 'block';
  clearTimeout(t._hid);
  t._hid = setTimeout(()=> t.style.display='none', ms);
}

/* -------------- ìº”ë²„ìŠ¤ ê³ í•´ìƒë„ ì„¤ì • & ì‹œê³„ ê·¸ë¦¬ê¸° ìœ í‹¸ -------------- */
function setupCanvas(canvas){
  // set internal resolution according to DPR while preserving CSS size
  const cssW = canvas.clientWidth;
  const cssH = canvas.clientHeight;
  const dpr = window.devicePixelRatio || 1;
  canvas.width = Math.round(cssW * dpr);
  canvas.height = Math.round(cssH * dpr);
  canvas.style.width = cssW + 'px';
  canvas.style.height = cssH + 'px';
  const ctx = canvas.getContext('2d');
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0); // scale drawing to match CSS pixels
  return { ctx, width: cssW, height: cssH, dpr };
}

function drawClock(ctxObj, angleDeg){
  const ctx = ctxObj.ctx;
  const W = ctxObj.width;
  const H = ctxObj.height;
  const cx = W/2, cy = H/2;
  const radius = Math.min(W,H) * 0.46;

  // clear
  ctx.clearRect(0,0,W,H);

  // background circle
  ctx.beginPath();
  ctx.arc(cx, cy, radius, 0, Math.PI*2);
  ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--clock-bg') || '#fff';
  ctx.fill();

  // concentric rings (íŒ½ì´ë¬´ëŠ¬)
  ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--tick') || '#000';
  ctx.lineWidth = 1;
  for(let r=20; r <= radius - 6; r += 12){
    ctx.beginPath();
    ctx.arc(cx, cy, r, 0, Math.PI*2);
    ctx.stroke();
  }

  // 12 ticks
  ctx.lineWidth = 2;
  for(let i=0;i<12;i++){
    const ang = (i * 30 - 90) * Math.PI/180;
    const x1 = cx + Math.cos(ang) * (radius - 8);
    const y1 = cy + Math.sin(ang) * (radius - 8);
    const x2 = cx + Math.cos(ang) * radius;
    const y2 = cy + Math.sin(ang) * radius;
    ctx.beginPath();
    ctx.moveTo(x1,y1);
    ctx.lineTo(x2,y2);
    ctx.stroke();
  }

  // fill arc from 12ì‹œ (top) clockwise by angleDeg
  if(typeof angleDeg === 'number' && angleDeg > 0){
    const start = -Math.PI/2;
    const end = start + angleDeg * Math.PI/180;
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.arc(cx, cy, radius, start, end, false);
    ctx.closePath();
    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--fill') || '#fff9c4';
    ctx.fill();
  }

  // central blue line (12ì‹œ)
  ctx.beginPath();
  ctx.moveTo(cx, cy);
  ctx.lineTo(cx, cy - radius);
  ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--center-line') || '#1e3a5f';
  ctx.lineWidth = 3;
  ctx.stroke();

  // small center dot
  ctx.beginPath();
  ctx.arc(cx, cy, 6, 0, Math.PI*2);
  ctx.fillStyle = '#111';
  ctx.fill();
}

/* -------------- ë©”ì¸ ì´ˆê¸°í™” -------------- */
(function(){
  const leftCanvas = document.getElementById('leftClock');
  const rightCanvas = document.getElementById('rightClock');

  // setup responsive internal resolution
  const left = setupCanvas(leftCanvas);
  const right = setupCanvas(rightCanvas);

  // initial render (no fill)
  drawClock(left, 0);
  drawClock(right, 0);

  // ì¬ë¦¬ì‚¬ì´ì¦ˆ ì²˜ë¦¬ (í™”ë©´ íšŒì „ ë“±)
  window.addEventListener('resize', ()=> {
    setupCanvas(leftCanvas);
    setupCanvas(rightCanvas);
    // re-get contexts
    const l = setupCanvas(leftCanvas);
    const r = setupCanvas(rightCanvas);
    drawClock(l, leftAngle || 0);
    drawClock(r, 0);
  });

  // pointer-based circular rotation (left only)
  let active = false;
  let leftAngle = 0;

  function getAngleFromEvent(evt, canvas){
    const rect = canvas.getBoundingClientRect();
    const clientX = evt.clientX !== undefined ? evt.clientX : (evt.touches && evt.touches[0] && evt.touches[0].clientX);
    const clientY = evt.clientY !== undefined ? evt.clientY : (evt.touches && evt.touches[0] && evt.touches[0].clientY);
    if(clientX === undefined || clientY === undefined) return null;
    const cx = rect.left + rect.width/2;
    const cy = rect.top + rect.height/2;
    const dx = clientX - cx;
    const dy = clientY - cy;
    let theta = Math.atan2(dy, dx) * 180 / Math.PI; // -180..180, 0 at +x
    theta = theta + 90; // shift so 0 at top
    if(theta < 0) theta += 360;
    return theta; // degrees 0..360
  }

  // left pointer handlers
  function onLeftPointerDown(e){
    e.preventDefault();
    active = true;
    // capture initial angle and render immed.
    const ang = getAngleFromEvent(e, leftCanvas);
    if(ang !== null){
      leftAngle = ang;
      drawClock(setupCanvas(leftCanvas), leftAngle);
    }
  }
  function onLeftPointerMove(e){
    if(!active) return;
    e.preventDefault();
    const ang = getAngleFromEvent(e, leftCanvas);
    if(ang !== null){
      leftAngle = ang;
      drawClock(setupCanvas(leftCanvas), leftAngle);
    }
  }
  function onLeftPointerUp(e){
    if(!active) return;
    active = false;
    showToast('ì„¤ì • ì™„ë£Œ! ìº¡ì²˜ ë²„íŠ¼ìœ¼ë¡œ ì €ì¥í•˜ì„¸ìš”. ğŸ“¸', 1600);
  }

  // right canvas tap -> locked toast
  function onRightTap(e){
    e.preventDefault();
    showToast('ìƒëŒ€ë°©ì˜ ê°ì •ì€ ë³¸ì¸ì´ ê±´ë“œë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 2000);
  }

  // attach pointer events (pointer API)
  leftCanvas.addEventListener('pointerdown', onLeftPointerDown, {passive:false});
  window.addEventListener('pointermove', onLeftPointerMove, {passive:false});
  window.addEventListener('pointerup', onLeftPointerUp, {passive:false});

  rightCanvas.addEventListener('pointerdown', onRightTap, {passive:false});

  // fallback for old browsers: touch events
  if(!window.PointerEvent){
    leftCanvas.addEventListener('touchstart', function(e){ onLeftPointerDown(e.touches[0]); }, {passive:false});
    leftCanvas.addEventListener('touchmove', function(e){ onLeftPointerMove(e.touches[0]); }, {passive:false});
    leftCanvas.addEventListener('touchend', function(e){ onLeftPointerUp(e); }, {passive:false});
    rightCanvas.addEventListener('touchstart', function(e){ onRightTap(e.touches[0]); }, {passive:false});
  }

  // capture button using html2canvas
  const captureBtn = document.getElementById('captureBtn');
  captureBtn.addEventListener('click', async function(){
    captureBtn.disabled = true;
    try{
      const area = document.getElementById('capture-area');
      const canvas = await html2canvas(area, {scale: Math.min(2, window.devicePixelRatio || 1.5), backgroundColor: null});
      const link = document.createElement('a');
      link.download = `time_of_us_${Date.now()}.png`;
      link.href = canvas.toDataURL('image/png');
      link.click();
      showToast('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ì¸ìŠ¤íƒ€ ìŠ¤í† ë¦¬ì— ì—…ë¡œë“œí•˜ì„¸ìš”. ğŸ™Œ', 2000);
    } catch(err){
      console.error(err);
      showToast('ìº¡ì²˜ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.', 3200);
    } finally {
      captureBtn.disabled = false;
    }
  });

})();
  </script>
</body>
</html>
